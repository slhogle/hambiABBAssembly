{
  "hash": "ed42e94387ccd1dcbb4c64ce8d8c85da",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Designing three-species subcommunities\"\nauthor: \"Shane Hogle\"\ndate: today\nlink-citations: true\n---\n\n\n# Setup\n\n## Libraries\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(here)\nlibrary(tidyverse)\nlibrary(ggplate)\n```\n:::\n\n\n## Global variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata <- here::here(\"data\", \"experiment_design\")\n\n# make processed data directory if it doesn't exist\nfs::dir_create(data)\n```\n:::\n\n\n## Functions and vars\n\nSpecies color vector\n\n::: {.cell}\n\n```{.r .cell-code}\nmy_colors <- c(\n  \"ANC_0403_10\" = \"#ffaaaa\", \"ANC_0403_70\" = \"#aa0000\", \"ANC_0403_80\" = \"#aa0000\", \"ANC_0403_90\" = \"#aa0000\", \n  \"ANC_1287_10\" = \"#ffeeaa\", \"ANC_1287_70\" = \"#d4aa00\", \"ANC_1287_80\" = \"#d4aa00\", \"ANC_1287_90\" = \"#d4aa00\", \n  \"ANC_1896_10\" = \"#ccffaa\", \"ANC_1896_70\" = \"#44aa00\", \"ANC_1896_80\" = \"#44aa00\", \"ANC_1896_90\" = \"#44aa00\", \n  \"ANC_1977_10\" = \"#aaccff\", \"ANC_1977_70\" = \"#0055d4\", \"ANC_1977_80\" = \"#0055d4\", \"ANC_1977_90\" = \"#0055d4\",\n  \"EVO_0403_10\" = \"#ffaaee\", \"EVO_0403_70\" = \"#ff00cc\", \"EVO_0403_80\" = \"#ff00cc\", \"EVO_0403_90\" = \"#ff00cc\", \n  \"EVO_1287_10\" = \"#ffccaa\", \"EVO_1287_70\" = \"#ff6600\", \"EVO_1287_80\" = \"#ff6600\", \"EVO_1287_90\" = \"#ff6600\", \n  \"EVO_1896_10\" = \"#aaffee\", \"EVO_1896_70\" = \"#00ffcc\", \"EVO_1896_80\" = \"#00ffcc\", \"EVO_1896_90\" = \"#00ffcc\", \n  \"EVO_1977_10\" = \"#ccaaff\", \"EVO_1977_70\" = \"#7f2aff\", \"EVO_1977_80\" = \"#7f2aff\", \"EVO_1977_90\" = \"#7f2aff\"\n  )\n```\n:::\n\n\nFor plotting plates\n\n::: {.cell}\n\n```{.r .cell-code}\nplate_plot_steps <- function(df, well_colmun, val_column, step, colr_vec){\n  ggplate::plate_plot(df,\n  position = {{ well_colmun }},\n  value = {{ val_column }},\n  colour = colr_vec,\n  plate_size = 96,\n  plate_type = \"round\"\n) + ggtitle(step)\n}\n```\n:::\n\n\n# Construct trio combinations\n\nGet all possible trios while excluding combinations of ANC/EVO of the same species\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombos03 <- t(combn(c(\"ANC_0403\", \"EVO_0403\", \"ANC_1287\", \"EVO_1287\", \"ANC_1977\", \"EVO_1977\", \"ANC_1896\", \"EVO_1896\"),  3))\ncombos03 <- tibble(\"a\" = combos03[, 1], \"b\" = combos03[, 2], \"c\" = combos03[, 3])\ncombos03_filt <- combos03 %>%\n  filter(str_extract(a, \"\\\\d+\") != str_extract(b, \"\\\\d+\")) %>% \n  filter(str_extract(a, \"\\\\d+\") != str_extract(c, \"\\\\d+\")) %>% \n  filter(str_extract(b, \"\\\\d+\") != str_extract(c, \"\\\\d+\"))\n```\n:::\n\n\nMake plate layouts for the 3-species combos\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombos03_filt_wells <- combos03_filt %>% \n  slice(rep(1:n(), each = 3)) %>%\n  mutate(a = paste(a, c(80, 10, 10), sep = \"_\"),\n         b = paste(b, c(10, 80, 10), sep = \"_\"),\n         c = paste(c, c(10, 10, 80), sep = \"_\")) %>% \n  arrange(a, b, c) %>% \n  # this is a kludge to arrange the species in the most continuous blocks\n  mutate(well = paste0(rep(c(LETTERS[c(c(1:8)[1:8%%2 == 1], \n                                         c(1:8)[1:8%%2 == 0])]), \n                             each = n()/8),\n                         str_pad(rep(1:12, times = n()/12), 2, pad = \"0\")))\n```\n:::\n\n\n## Format and save\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncombos03_filt_wells %>%\n  group_by(a, b, c) %>% \n  mutate(microcosm_id = cur_group_id()) %>% \n  ungroup() %>% \n  mutate(a_sp = paste0(str_split_i(a, \"_\", 2), stringr::str_extract(str_split_i(a, \"_\", 1), \"^.{1}\")),\n         b_sp = paste0(str_split_i(b, \"_\", 2), stringr::str_extract(str_split_i(b, \"_\", 1), \"^.{1}\")),\n         c_sp = paste0(str_split_i(c, \"_\", 2), stringr::str_extract(str_split_i(c, \"_\", 1), \"^.{1}\")),\n         a_f = str_split_i(a, \"_\", 3),\n         b_f = str_split_i(b, \"_\", 3),\n         c_f = str_split_i(c, \"_\", 3)) %>% \n  arrange(well) %>% \n  dplyr::select(microcosm_id, well, a, a_sp, a_f, b, b_sp, b_f, c, c_sp, c_f) %>% \n  readr::write_tsv(here::here(data, \"trios_sample_composition_wide.tsv\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombos03_filt_wells %>%\n  group_by(a, b, c) %>% \n  mutate(microcosm_id = cur_group_id()) %>% \n  ungroup() %>% \n  dplyr::select(a:c, well, microcosm_id) %>% \n  tidyr::pivot_longer(c(-well, -microcosm_id)) %>% \n  tidyr::separate(value, c(\"evo_hist\", \"strainID\", \"target_f\")) %>% \n  dplyr::mutate(evo_hist = stringr::str_to_lower(evo_hist),\n                strainID = paste0(\"HAMBI_\", strainID),\n                target_f = as.numeric(target_f)/100,\n                n_species = 3) %>% \n  dplyr::select(-name) %>% \n  dplyr::relocate(microcosm_id, n_species) %>% \n  readr::write_tsv(here::here(data, \"trios_sample_composition_long.tsv\"))\n```\n:::\n\n\n# Pipetting\n\nProceed in the order of steps below to construct master plates used to inoculate different conditions\n\n## First pipetting step\n\n::: {#fig-01}\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_trios_files/figure-html/unnamed-chunk-9-1.png){width=768}\n:::\n:::\n\nLayout for the first pipetting step for constructing trios Different colors show different species/evolution combinations. The darkness of the color indicates whether a species/evolution combo is added at 80% (e.g., `_80`) or 10% (e.g., `_10`).\n:::\n\n## Second pipetting step\n\n::: {#fig-02}\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_trios_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\nLayout for the second pipetting step for constructing trios Different colors show different species/evolution combinations. The darkness of the color indicates whether a species/evolution combo is added at 80% (e.g., `_80`) or 10% (e.g., `_10`).\n:::\n\n## Third pipetting step\n\n::: {#fig-03}\n\n::: {.cell}\n::: {.cell-output-display}\n![](02_trios_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\nLayout for the third pipetting step for constructing trios Different colors show different species/evolution combinations. The darkness of the color indicates whether a species/evolution combo is added at 80% (e.g., `_80`) or 10% (e.g., `_10`).\n:::",
    "supporting": [
      "02_trios_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}